var postTitle=[],postUrl=[],postDate=[],postSum=[],postLabels=[],sortBy="datenewest",tocLoaded=!1,numChars=250,postFilter="",tocdiv=document.getElementById("bp_toc"),totalEntires=0,totalPosts=0;function loadtoc(a){(function(){if("entry"in a.feed){var c=a.feed.entry.length;if(totalEntires+=c,totalPosts=a.feed.openSearch$totalResults.$t,totalPosts>totalEntires){var d=document.createElement("script");d.type="text/javascript",startindex=totalEntires+1,d.setAttribute("src","/feeds/posts/summary?start-index="+startindex+"&max-results=500&alt=json-in-script&callback=loadtoc"),tocdiv.appendChild(d)}for(var e=0;e<c;e++){for(var m,f=a.feed.entry[e],g=f.title.$t,h=f.published.$t.substring(0,10),n=0;n<f.link.length;n++)if("alternate"==f.link[n].rel){m=f.link[n].href;break}if("content"in f)var o=f.content.$t;else if("summary"in f)var o=f.summary.$t;else var o="";var p=/<\S[^>]*>/g;if(o=o.replace(p,""),o.length>numChars){o=o.substring(0,numChars);var q=o.lastIndexOf(" ");o=o.substring(0,q)+"..."}var r="";if("category"in f){for(var n=0;n<f.category.length;n++)r+="<a href=\"javascript:filterPosts('"+f.category[n].term+"');\" title=\"Click here to select all posts with label '"+f.category[n].term+"'\">"+f.category[n].term+"</a>,  ";var s=r.lastIndexOf(",");-1!=s&&(r=r.substring(0,s))}postTitle.push(g),postDate.push(h),postUrl.push(m),postSum.push(o),postLabels.push(r)}}totalEntires==totalPosts&&(tocLoaded=!0,showToc())})(),sortPosts(sortBy),tocLoaded=!0}function filterPosts(a){postFilter=a,displayToc(postFilter)}function allPosts(){postFilter="",displayToc(postFilter)}function sortPosts(a){function b(e,f){var g=postTitle[e];postTitle[e]=postTitle[f],postTitle[f]=g;var g=postDate[e];postDate[e]=postDate[f],postDate[f]=g;var g=postUrl[e];postUrl[e]=postUrl[f],postUrl[f]=g;var g=postSum[e];postSum[e]=postSum[f],postSum[f]=g;var g=postLabels[e];postLabels[e]=postLabels[f],postLabels[f]=g}for(var c=0;c<postTitle.length-1;c++)for(var d=c+1;d<postTitle.length;d++)"titleasc"==a&&postTitle[c]>postTitle[d]&&b(c,d),"titledesc"==a&&postTitle[c]<postTitle[d]&&b(c,d),"dateoldest"==a&&postDate[c]>postDate[d]&&b(c,d),"datenewest"==a&&postDate[c]<postDate[d]&&b(c,d)}function displayToc(a){var b=0,c="",e="Click to sort by title",g="Click to sort by date",m="";"titleasc"==sortBy&&(e+=" (descending)",g+=" (newest first)"),"titledesc"==sortBy&&(e+=" (ascending)",g+=" (newest first)"),"dateoldest"==sortBy&&(e+=" (ascending)",g+=" (newest first)"),"datenewest"==sortBy&&(e+=" (ascending)",g+=" (oldest first)"),""!=postFilter&&(m="Click to show all posts"),c+="<table>",c+="<tr>",c+="<td class=\"toc-header-col1\">",c+="<a href=\"javascript:toggleTitleSort();\" title=\""+e+"\">"+"\u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u062A\u062F\u0648\u064A\u0646\u0629"+"</a>",c+="</td>",c+="<td class=\"toc-header-col2\">",c+="<a href=\"javascript:toggleDateSort();\" title=\""+g+"\">"+"\u0627\u0644\u062A\u0627\u0631\u064A\u062E"+"</a>",c+="</td>",c+="<td class=\"toc-header-col3\">",c+="<a href=\"javascript:allPosts();\" title=\""+m+"\">"+"\u0627\u0644\u0623\u0642\u0633\u0627\u0645"+"</a>",c+="</td>",c+="</tr>";for(var n=0;n<postTitle.length;n++)""==a?(c+="<tr><td class=\"toc-entry-col1\"><a href=\""+postUrl[n]+"\" title=\""+postSum[n]+"\">"+postTitle[n]+"</a></td><td class=\"toc-entry-col2\">"+postDate[n]+"</td><td class=\"toc-entry-col3\">"+postLabels[n]+"</td></tr>",b++):(z=postLabels[n].lastIndexOf(a),-1!=z&&(c+="<tr><td class=\"toc-entry-col1\"><a href=\""+postUrl[n]+"\" title=\""+postSum[n]+"\">"+postTitle[n]+"</a></td><td class=\"toc-entry-col2\">"+postDate[n]+"</td><td class=\"toc-entry-col3\">"+postLabels[n]+"</td></tr>",b++));if(c+="</table>",b==postTitle.length)var o="<span class=\"toc-note\"> \u0639\u062F\u062F \u0627\u0644\u062A\u062F\u0648\u064A\u0646\u0627\u062A: <p>"+postTitle.length+"</p> \u062A\u062F\u0648\u064A\u0646\u0629<br/></span>";else{var o="<span class=\"toc-note\"> \u0639\u062F\u062F \u0627\u0644\u062A\u062F\u0648\u064A\u0646\u0627\u062A \u0627\u0644\u062E\u0627\u0635\u0629 \u0628\u0642\u0633\u0645 '";o+=postFilter+"' \u0647\u0648 <p>"+b+"</p> *** \u0627\u0644\u0639\u062F\u062F \u0627\u0644\u0643\u0644\u064A \u0644\u0644\u062A\u062F\u0648\u064A\u0646\u0627\u062A \u0647\u0648 <p>"+postTitle.length+"</p></span>"}tocdiv.innerHTML=o+c}function toggleTitleSort(){sortBy="titleasc"==sortBy?"titledesc":"titleasc",sortPosts(sortBy),displayToc(postFilter)}function toggleDateSort(){sortBy="datenewest"==sortBy?"dateoldest":"datenewest",sortPosts(sortBy),displayToc(postFilter)}function showToc(){if(tocLoaded){displayToc(postFilter);document.getElementById("toclink")}else alert("Just wait... TOC is loading")}